<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>serialize.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="ObjectMapper.html">ObjectMapper</a><ul class='methods'><li data-type='method'><a href="ObjectMapper.html#.deserialize">deserialize</a></li><li data-type='method'><a href="ObjectMapper.html#.serialize">serialize</a></li></ul></li></ul><h3>Interfaces</h3><ul><li><a href="ObjectMapper.SerializerInfo.html">SerializerInfo</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">serialize.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.serialize = void 0;
/*
 * MIT License
 *
 * Copyright (c) 2020 UXLand
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the
 * Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH
 * THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
const R = require("ramda");
const utilities_1 = require("./utilities");
const validation_1 = require("./validation");
const buildFirstIndexPath = R.pipe(R.split('.'), (paths) => [paths[0], 0, ...R.remove(0, 1, paths)]);
const getPropForArray = (from, data) => from.map((fromK) => (data ? data[fromK] : undefined));
const getPropForPath = (from, data) => {
    const path = R.split('.', from);
    const item = data[path[0]];
    return utilities_1.isObject(item)
        ? R.path(path, data)
        : utilities_1.isSingleObject(item)
            ? R.path(buildFirstIndexPath(from), data)
            : utilities_1.thrower(validation_1.invalidPath);
};
const getProp = (from, data) => utilities_1.isArray(from)
    ? getPropForArray(from, data)
    : utilities_1.isPath(from)
        ? getPropForPath(from, data)
        : data[from];
const multipleTo = (data, from, to, fn) => 
// eslint-disable-next-line @typescript-eslint/no-use-before-define
to.reduce((collection, toK) => inToOut(data, R.equals(from, to) ? toK : from, toK, fn)(collection), {});
const executeFn = (data, from, fn) => utilities_1.isArray(from) ? fn(...data) : utilities_1.isArray(data) ? data.map(d => fn(d)) : fn(data);
const assignInputToOutput = (data, from, to, serializerFn, serializers) => (output) => {
    if (!serializerFn &amp;&amp; !serializers)
        return utilities_1.setProperty(from, to, data)(output);
    else if (serializerFn)
        return utilities_1.setProperty(from, to, executeFn(data, from, serializerFn))(output);
    // eslint-disable-next-line @typescript-eslint/no-use-before-define
    else
        return utilities_1.setProperty(from, to, serialize(data, serializers))(output);
};
const inToOut = (data, from, to, fn, serializers) => (output) => utilities_1.isArray(to)
    ? multipleTo(data, from, to, fn)
    : assignInputToOutput(getProp(from, data), from, to, fn, serializers)(output);
const serializeArray = (i, serializers) => 
// eslint-disable-next-line @typescript-eslint/no-use-before-define
i.map(d => serialize(d, serializers));
const serializeObject = (i, serializers) => serializers.reduce((o, s) => inToOut(i, utilities_1.getFrom(s), utilities_1.getTo(s), utilities_1.getSerializerFn(s), utilities_1.getSerializers(s))(o), {});
/**
 * Serialize data using serializers
 * @memberof ObjectMapper
 * @function
 * @name serialize
 * @param {(*|Array.&lt;*>)} i Input data or array data to be serialized
 * @param {ObjectMapper.SerializerInfo=} serializers Serializers array. Must contain at least a "from" property.
 */
function serialize(i, serializers) {
    if (validation_1.validSerializers(serializers))
        return utilities_1.isArray(i) ? serializeArray(i, serializers) : serializeObject(i, serializers);
    return i;
}
exports.serialize = serialize;
/**
 //TODO: Prepare console warnings for inconsistencies between serialization and deserialization.
 * i.e.: When using sub-serializers with non-object structure:
 * const input = {foo: 'bar'};
 * const serializers = [{from: 'foo', serializers: [{from: 'bar'}]}];
 * const output = serialize(input, serializers); // {foo: {bar: undefined}};
 * This is not possible to deserialize
 */
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
